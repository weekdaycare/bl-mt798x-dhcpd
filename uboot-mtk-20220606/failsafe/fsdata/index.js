function ajax(n) { var t, i; t = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"); t.upload && n && n.progress && t.upload.addEventListener("progress", function (t) { n.progress(t) }); t.onreadystatechange = function () { if (t.readyState === 4) { if (t.status === 200) { n && n.done && n.done(t.responseText); return } n && n.fail && n.fail(t) } }; n && n.timeout && (t.timeout = n.timeout); i = "GET"; n && n.data && (i = "POST"); t.open(i, n.url); t.send(n.data) } function getTheme() { var n = null; try { n = localStorage.getItem("theme") } catch (t) { } return n === "light" || n === "dark" || n === "auto" ? n : "auto" } function applyTheme() { var t = getTheme(), n; document.documentElement.setAttribute("data-theme", t); n = document.getElementById("themeSelect"); n && (n.value = t) } function setTheme(n) { n !== "light" && n !== "dark" && n !== "auto" && (n = "auto"); try { localStorage.setItem("theme", n) } catch (t) { } applyTheme() } function normalizeLang(n) { var t = (n || "").toLowerCase(); return t.indexOf("zh") === 0 ? "zh-cn" : "en" } function getLang() { var n = null; try { n = localStorage.getItem("lang") } catch (t) { } return n && I18N[n] ? n : normalizeLang(navigator.language || navigator.userLanguage || "en") } function setLang(n) { I18N[n] || (n = "en"); try { localStorage.setItem("lang", n) } catch (i) { } applyI18n(document); var t = document.getElementById("langSelect"); t && (t.value = n) } function t(n) { var i = getLang(), t = I18N[i] || I18N.en; return t && t[n] || I18N.en && I18N.en[n] || n } function applyI18n(n) { var v, f, e, o, i, s, y, h, r, c, p, l, u, a, w; for (n = n || document, applyTheme(), v = getLang(), f = document.getElementById("langSelect"), f && (f.value = v), e = document.documentElement.getAttribute("data-title-key"), e && (document.title = t(e)), o = n.querySelectorAll("[data-i18n]"), i = 0; i < o.length; i++)s = o[i], y = s.getAttribute("data-i18n"), s.textContent = t(y); for (h = n.querySelectorAll("[data-i18n-html]"), r = 0; r < h.length; r++)c = h[r], p = c.getAttribute("data-i18n-html"), c.innerHTML = t(p); for (l = n.querySelectorAll("[data-i18n-value]"), u = 0; u < l.length; u++)a = l[u], w = a.getAttribute("data-i18n-value"), a.setAttribute("value", t(w)) } function initCommonUi() { var n, t; applyTheme(); ensureYuzhii(); n = document.getElementById("themeSelect"); n && !n.__bound && (n.__bound = !0, n.addEventListener("change", function () { setTheme(n.value) })); t = document.getElementById("langSelect"); t && !t.__bound && (t.__bound = !0, t.addEventListener("change", function () { setLang(t.value) })); applyI18n(document) } function ensureYuzhii() { var t = document.getElementById("version"), i, n; t && ((i = document.getElementById("yuzhii"), i) || (n = document.createElement("div"), n.id = "yuzhii", n.textContent = "ğŸ’¡Yuzhii", n.style.textAlign = "center", n.style.opacity = "0.85", n.style.marginTop = "6px", t.insertAdjacentElement("afterend", n))) } function showPanel(n) { for (var u, f, t, i, o, e = document.querySelectorAll(".panel"), r = 0; r < e.length; r++)e[r].classList.add("hidden"); for (u = document.getElementById(n), u && u.classList.remove("hidden"), f = document.querySelectorAll("[data-target]"), t = 0; t < f.length; t++)i = f[t], o = i.getAttribute("data-target") === n, o ? i.classList.add("active") : i.classList.remove("active") } function bindNav() { for (var t = document.querySelectorAll("[data-target]"), n = 0; n < t.length; n++)(function () { var i = t[n]; i.__bound || (i.__bound = !0, i.addEventListener("click", function (n) { var r, t; if (i.tagName === "A" && (r = i.getAttribute("href") || "", r.indexOf("#") === 0 && n.preventDefault()), t = i.getAttribute("data-target"), t) { showPanel(t); try { location.hash = "#" + t } catch (u) { } } })) })() } function initIndex() { var n, t; initCommonUi(); getversion(); getmtdlayoutlist(document.getElementById("panel-firmware")); bindNav(); n = "panel-firmware"; location.hash && location.hash.length > 1 && (t = location.hash.substring(1), document.getElementById(t) && (n = t)); showPanel(n) } function initPage() { initCommonUi(); getversion() } function startup() { initCommonUi(); getversion(); getmtdlayoutlist(document) } function getversion() { ajax({ url: "/version", done: function (n) { var t = document.getElementById("version"); t && (t.textContent = n) } }) } function getmtdlayoutlist(n) { n = n || document; var r = n.querySelector('[data-role="mtd_layout"]') || n.querySelector("#mtd_layout"), u = n.querySelector('[data-role="current_mtd_layout"]') || n.querySelector("#current_mtd_layout"), i = n.querySelector('[data-role="mtd_layout_label"]') || n.querySelector("#mtd_layout_label"); r && u && i && ajax({ url: "/getmtdlayout", done: function (n) { var f, e; if (n !== "error") { for (f = n.split(";"), u.textContent = t("mtd.currentPrefix") + f[0], i.options.length = 0, e = 1; e < f.length; e++)f[e] && f[e].length > 0 && i.options.add(new Option(f[e], f[e])); r.style.display = "" } } }) } function findInRoot(n, t, i) { if (n) { var r = n.querySelector(t); if (r) return r } return i ? document.getElementById(i) : null } function upload(n, i) { var r = null, y, s, p; r = typeof i == "string" ? document.getElementById(i) : i && i.nodeType === 1 ? i : document; var e = findInRoot(r, '[data-role="file"]', "file"), l = findInRoot(r, '[data-role="form"]', "form"), a = findInRoot(r, '[data-role="hint"]', "hint"), u = findInRoot(r, '[data-role="bar"]', "bar"), h = findInRoot(r, '[data-role="size"]', "size"), c = findInRoot(r, '[data-role="md5"]', "md5"), o = findInRoot(r, '[data-role="mtd"]', "mtd"), v = findInRoot(r, '[data-role="upgrade"]', "upgrade"), f = findInRoot(r, '[data-role="mtd_layout_label"]', "mtd_layout_label"); e && e.files && e.files[0] && (y = e.files[0], l && (l.style.display = "none"), a && (a.style.display = "none"), s = new FormData, s.append(n, y), f && f.options && f.options.length > 0 && (p = f.selectedIndex, s.append("mtd_layout", f.options[p].value)), u && (u.style.display = "block", u.style.setProperty("--percent", 0)), ajax({ url: "/upload", data: s, done: function (n) { if (n === "fail") { location = "/fail.html"; return } var i = (n || "").split(" "), u = i[0] || "", f = i[1] || "", r = i[2] || ""; h && (h.style.display = "block", h.textContent = t("label.size") + ": " + u); c && (c.style.display = "block", c.textContent = t("label.md5") + ": " + f); o && (r ? (o.style.display = "block", o.textContent = t("label.mtd") + ": " + r) : o.style.display = "none"); v && (v.style.display = "block") }, progress: function (n) { if (u && n && n.total) { var t = parseInt(n.loaded / n.total * 100, 10); t < 0 && (t = 0); t > 100 && (t = 100); u.style.setProperty("--percent", t) } } })) } var I18N = { en: { "app.title": "Recovery Mode WEBUI", "app.subtitle": "Device web updater", "lang.label": "ğŸŒLanguage", "theme.label": "ğŸŒ“Theme", "theme.auto": "Auto", "theme.light": "Light", "theme.dark": "Dark", "nav.basic": "Basic", "nav.advanced": "Advanced", "nav.firmware": "Firmware", "nav.uboot": "U-Boot", "nav.bl2": "BL2", "nav.gpt": "GPT", "nav.initramfs": "Initramfs", "panel.firmware.title": "Firmware update", "panel.uboot.title": "U-Boot update", "panel.bl2.title": "BL2 update", "panel.gpt.title": "GPT update", "panel.initramfs.title": "Load initramfs", "panel.firmware.hint": "You are going to update <strong>firmware<\/strong> on the device.<br>Please choose a file from your computer and click <strong>Upload<\/strong>.", "panel.uboot.hint": "You are going to update <strong>U-Boot (bootloader)<\/strong> on the device.<br>Please choose a file from your computer and click <strong>Upload<\/strong>.", "panel.bl2.hint": "You are going to update <strong>BL2 (preloader)<\/strong> on the device.<br>Please choose a file from your computer and click <strong>Upload<\/strong>.", "panel.gpt.hint": "You are going to update <strong>GPT (Partition Table)<\/strong> on the device.<br>Please choose a file from your computer and click <strong>Upload<\/strong>.", "panel.initramfs.hint": "You are going to load <strong>initramfs<\/strong> on the device.<br>Please choose a file from your computer and click <strong>Upload<\/strong>.", "mtd.choose": "Choose MTD layout", "mtd.currentPrefix": "Current MTD layout: ", "label.size": "Size", "label.md5": "MD5", "label.mtd": "MTD layout", "btn.upload": "Upload", "btn.update": "Update", "btn.boot": "Boot", "confirm.update": "If all information above is correct, click â€œUpdateâ€.", "confirm.boot": "If all information above is correct, click â€œBootâ€.", "warn.title": "Warnings", "warn.noPowerOff": "Do not power off the device during update", "warn.restart": "If everything goes well, the device will restart", "warn.chooseProperFirmware": "You can upload whatever you want, so be sure you choose the proper firmware image for your device", "warn.chooseProperUboot": "You can upload whatever you want, so be sure you choose the proper U-Boot image for your device", "warn.chooseProperBl2": "You can upload whatever you want, so be sure you choose the proper BL2 image for your device", "warn.chooseProperGpt": "You can upload whatever you want, so be sure you choose the proper GPT for your device", "warn.ubootDanger": "Updating U-Boot is a very dangerous operation and may damage your device!", "warn.bl2Danger": "Updating BL2 is a very dangerous operation and may damage your device!", "warn.gptDanger": "Updating GPT is a dangerous operation and may damage your device!", "warn.initramfsBoot": "If everything goes well, the device will boot into the initramfs", "warn.chooseProperInitramfs": "You can upload whatever you want, so be sure you choose the proper initramfs image for your device", "page.flashing.title": "Update in progress", "page.flashing.h1": "Update in progress", "page.flashing.info": "Your file was successfully uploaded! Update is in progress and you should wait for automatic reset of the device.<br>Update time depends on image size and may take up to a few minutes.", "page.flashing.doneH1": "Update completed", "page.flashing.doneInfo": "Your device was successfully updated! Now rebooting...", "page.booting.title": "Booting initramfs", "page.booting.h1": "Booting initramfs", "page.booting.info": "Your file was successfully uploaded! Booting is in progress, please wait...<br>This page may be unresponsive for a short time.", "page.booting.doneH1": "Boot success", "page.booting.doneInfo": "Your device was successfully booted into initramfs!", "page.fail.title": "Update failed", "page.fail.h1": "Update failed", "page.fail.msgStrong": "Something went wrong during update", "page.fail.msg": "Probably you have chosen a wrong file. Please try again or contact the author of this modification. You can also get more information during update in U-Boot console.", "page.404.title": "Page not found", "page.404.h1": "Page not found", "page.404.msg": "The page you were looking for doesn't exist!" }, "zh-cn": { "app.title": "æ¢å¤æ¨¡å¼ WEBUI", "app.subtitle": "è®¾å¤‡ Web æ›´æ–°å·¥å…·", "lang.label": "ğŸŒè¯­è¨€", "theme.label": "ğŸŒ“ä¸»é¢˜", "theme.auto": "è‡ªåŠ¨", "theme.light": "æµ…è‰²", "theme.dark": "æ·±è‰²", "nav.basic": "åŸºç¡€åŠŸèƒ½", "nav.advanced": "é«˜çº§åŠŸèƒ½", "nav.firmware": "å›ºä»¶å‡çº§", "nav.uboot": "U-Boot å‡çº§", "nav.bl2": "BL2 å‡çº§", "nav.gpt": "GPT å‡çº§", "nav.initramfs": "Initramfs å¯åŠ¨", "panel.firmware.title": "å›ºä»¶å‡çº§", "panel.uboot.title": "U-Boot å‡çº§", "panel.bl2.title": "BL2 å‡çº§", "panel.gpt.title": "GPT å‡çº§", "panel.initramfs.title": "åŠ è½½ Initramfs", "panel.firmware.hint": "ä½ å°†è¦åœ¨è®¾å¤‡ä¸Šå‡çº§ <strong>å›ºä»¶<\/strong>ã€‚<br>è¯·é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¹¶ç‚¹å‡» <strong>ä¸Šä¼ <\/strong>ã€‚", "panel.uboot.hint": "ä½ å°†è¦åœ¨è®¾å¤‡ä¸Šå‡çº§ <strong>U-Bootï¼ˆå¼•å¯¼ç¨‹åºï¼‰<\/strong>ã€‚<br>è¯·é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¹¶ç‚¹å‡» <strong>ä¸Šä¼ <\/strong>ã€‚", "panel.bl2.hint": "ä½ å°†è¦åœ¨è®¾å¤‡ä¸Šå‡çº§ <strong>BL2ï¼ˆé¢„åŠ è½½ï¼‰<\/strong>ã€‚<br>è¯·é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¹¶ç‚¹å‡» <strong>ä¸Šä¼ <\/strong>ã€‚", "panel.gpt.hint": "ä½ å°†è¦åœ¨è®¾å¤‡ä¸Šå‡çº§ <strong>GPTï¼ˆåˆ†åŒºè¡¨ï¼‰<\/strong>ã€‚<br>è¯·é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¹¶ç‚¹å‡» <strong>ä¸Šä¼ <\/strong>ã€‚", "panel.initramfs.hint": "ä½ å°†è¦åœ¨è®¾å¤‡ä¸Šå¯åŠ¨ <strong>initramfs<\/strong>ã€‚<br>è¯·é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¹¶ç‚¹å‡» <strong>ä¸Šä¼ <\/strong>ã€‚", "mtd.choose": "é€‰æ‹© MTD å¸ƒå±€", "mtd.currentPrefix": "å½“å‰ MTD å¸ƒå±€ï¼š", "label.size": "å¤§å°", "label.md5": "MD5", "label.mtd": "MTD å¸ƒå±€", "btn.upload": "ä¸Šä¼ ", "btn.update": "æ›´æ–°", "btn.boot": "å¯åŠ¨", "confirm.update": "å¦‚æœä»¥ä¸Šä¿¡æ¯æ— è¯¯ï¼Œè¯·ç‚¹å‡»â€œæ›´æ–°â€ã€‚", "confirm.boot": "å¦‚æœä»¥ä¸Šä¿¡æ¯æ— è¯¯ï¼Œè¯·ç‚¹å‡»â€œå¯åŠ¨â€ã€‚", "warn.title": "æ³¨æ„äº‹é¡¹", "warn.noPowerOff": "æ›´æ–°è¿‡ç¨‹ä¸­è¯·å‹¿æ–­ç”µ", "warn.restart": "æ›´æ–°æˆåŠŸåè®¾å¤‡ä¼šè‡ªåŠ¨é‡å¯", "warn.chooseProperFirmware": "ä½ å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œè¯·ç¡®ä¿é€‰æ‹©äº†é€‚ç”¨äºè®¾å¤‡çš„æ­£ç¡®å›ºä»¶é•œåƒ", "warn.chooseProperUboot": "ä½ å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œè¯·ç¡®ä¿é€‰æ‹©äº†é€‚ç”¨äºè®¾å¤‡çš„æ­£ç¡® U-Boot é•œåƒ", "warn.chooseProperBl2": "ä½ å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œè¯·ç¡®ä¿é€‰æ‹©äº†é€‚ç”¨äºè®¾å¤‡çš„æ­£ç¡® BL2 é•œåƒ", "warn.chooseProperGpt": "ä½ å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œè¯·ç¡®ä¿é€‰æ‹©äº†é€‚ç”¨äºè®¾å¤‡çš„æ­£ç¡® GPT", "warn.ubootDanger": "æ›´æ–° U-Boot é£é™©æé«˜ï¼Œå¯èƒ½ä¼šæŸåè®¾å¤‡ï¼", "warn.bl2Danger": "æ›´æ–° BL2 é£é™©æé«˜ï¼Œå¯èƒ½ä¼šæŸåè®¾å¤‡ï¼", "warn.gptDanger": "æ›´æ–° GPT å­˜åœ¨é£é™©ï¼Œå¯èƒ½ä¼šæŸåè®¾å¤‡ï¼", "warn.initramfsBoot": "è‹¥ä¸€åˆ‡æ­£å¸¸ï¼Œè®¾å¤‡å°†å¯åŠ¨è¿›å…¥ initramfs", "warn.chooseProperInitramfs": "ä½ å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œè¯·ç¡®ä¿é€‰æ‹©äº†é€‚ç”¨äºè®¾å¤‡çš„æ­£ç¡® initramfs é•œåƒ", "page.flashing.title": "æ­£åœ¨æ›´æ–°", "page.flashing.h1": "æ­£åœ¨æ›´æ–°", "page.flashing.info": "æ–‡ä»¶å·²æˆåŠŸä¸Šä¼ ï¼æ­£åœ¨æ‰§è¡Œæ›´æ–°ï¼Œè¯·ç­‰å¾…è®¾å¤‡è‡ªåŠ¨é‡å¯ã€‚<br>æ›´æ–°æ—¶é—´å–å†³äºé•œåƒå¤§å°ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿã€‚", "page.flashing.doneH1": "æ›´æ–°å®Œæˆ", "page.flashing.doneInfo": "è®¾å¤‡å·²æˆåŠŸæ›´æ–°ï¼æ­£åœ¨é‡å¯â€¦", "page.booting.title": "æ­£åœ¨å¯åŠ¨ Initramfs", "page.booting.h1": "æ­£åœ¨å¯åŠ¨ Initramfs", "page.booting.info": "æ–‡ä»¶å·²æˆåŠŸä¸Šä¼ ï¼æ­£åœ¨å¯åŠ¨ï¼Œè¯·ç¨å€™â€¦<br>æ­¤é¡µé¢å¯èƒ½ä¼šçŸ­æš‚æ— å“åº”ã€‚", "page.booting.doneH1": "å¯åŠ¨æˆåŠŸ", "page.booting.doneInfo": "è®¾å¤‡å·²æˆåŠŸå¯åŠ¨è¿›å…¥ initramfsï¼", "page.fail.title": "æ›´æ–°å¤±è´¥", "page.fail.h1": "æ›´æ–°å¤±è´¥", "page.fail.msgStrong": "æ›´æ–°è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯", "page.fail.msg": "å¯èƒ½é€‰æ‹©äº†é”™è¯¯çš„æ–‡ä»¶ã€‚è¯·é‡è¯•æˆ–è”ç³»æ­¤ä¿®æ”¹çš„ä½œè€…ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨ U-Boot æ§åˆ¶å°ä¸­è·å–æ›´å¤šä¿¡æ¯ã€‚", "page.404.title": "é¡µé¢ä¸å­˜åœ¨", "page.404.h1": "é¡µé¢ä¸å­˜åœ¨", "page.404.msg": "ä½ è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨ï¼" } }