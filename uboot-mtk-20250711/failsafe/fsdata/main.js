function normalizeLang(n) { if (!n) return "en"; var t = String(n).toLowerCase(); return t.indexOf("zh") === 0 ? "zh-cn" : "en" } function detectLang() { var t, n; try { if (t = localStorage.getItem("lang"), t) return normalizeLang(t) } catch (i) { } return n = [], navigator.languages && navigator.languages.length ? n = navigator.languages : navigator.language && (n = [navigator.language]), normalizeLang(n[0]) } function detectTheme() { try { var n = localStorage.getItem("theme"); if (n) return n } catch (t) { } return "auto" } function t(n) { var t = APP_STATE.lang || "en"; return I18N[t] && I18N[t][n] !== undefined ? I18N[t][n] : I18N.en && I18N.en[n] !== undefined ? I18N.en[n] : n } function applyI18n(n) { for (var c, f, i, l, e, r, a, o, v, y, s = n || document, h = s.querySelectorAll("[data-i18n]"), u = 0; u < h.length; u++)c = h[u].getAttribute("data-i18n"), h[u].textContent = t(c); for (f = s.querySelectorAll("[data-i18n-html]"), i = 0; i < f.length; i++)l = f[i].getAttribute("data-i18n-html"), f[i].innerHTML = t(l); for (e = s.querySelectorAll("[data-i18n-attr]"), r = 0; r < e.length; r++)a = e[r].getAttribute("data-i18n-attr"), o = a.split(":"), o.length >= 2 && (v = o[0], y = o.slice(1).join(":"), e[r].setAttribute(v, t(y))) } function setLang(n) { APP_STATE.lang = normalizeLang(n); try { localStorage.setItem("lang", APP_STATE.lang) } catch (t) { } applyI18n(document); updateDocumentTitle() } function setTheme(n) { APP_STATE.theme = n || "auto"; try { localStorage.setItem("theme", APP_STATE.theme) } catch (i) { } var t = document.documentElement; APP_STATE.theme === "auto" ? t.removeAttribute("data-theme") : t.setAttribute("data-theme", APP_STATE.theme) } function updateDocumentTitle() { if (APP_STATE.page) { var n = APP_STATE.page + ".title"; if (I18N[APP_STATE.lang] && I18N[APP_STATE.lang][n]) { document.title = t(n); return } APP_STATE.page === "flashing" ? document.title = t("flashing.title.in_progress") : APP_STATE.page === "booting" && (document.title = t("booting.title.in_progress")) } } function ensureBranding() { var i = document.getElementById("version"), n, t; i && ((n = i.nextElementSibling, n && n.classList && n.classList.contains("brand")) || (t = document.createElement("div"), t.className = "brand", t.textContent = "ğŸ’¡Yuzhii", i.insertAdjacentElement("afterend", t))) } function ensureSidebar() { function o(n, i, r) { var u = document.createElement("a"), s, o, e, h; return u.className = "nav-link", u.href = n, u.setAttribute("data-nav-id", r), s = document.createElement("span"), s.className = "dot", u.appendChild(s), o = document.createElement("span"), o.setAttribute("data-i18n", i), o.textContent = t(i), u.appendChild(o), e = n, e !== "/" && e.charAt(0) !== "/" && (e = "/" + e), h = e === f || e === "/" && (f === "/" || f === "/index.html"), h && u.classList.add("active"), u } var i = document.getElementById("sidebar"), f, k, s, h, c, d, r, l, g, n, a, v, y, p, e, w, u, b; i && i.getAttribute("data-rendered") !== "1" && (i.setAttribute("data-rendered", "1"), f = location && location.pathname ? location.pathname : "", f === "" && (f = "/"), i.innerHTML = "", k = document.createElement("div"), k.className = "sidebar-brand", s = document.createElement("div"), s.className = "title", s.setAttribute("data-i18n", "app.name"), s.textContent = t("app.name"), k.appendChild(s), i.appendChild(k), h = document.createElement("div"), h.className = "sidebar-controls", c = document.createElement("div"), c.className = "control-row", d = document.createElement("div"), d.setAttribute("data-i18n", "control.language"), d.textContent = t("control.language"), c.appendChild(d), r = document.createElement("select"), r.id = "lang_select", r.innerHTML = '<option value="en">English<\/option><option value="zh-cn">ç®€ä½“ä¸­æ–‡<\/option>', r.value = APP_STATE.lang, r.onchange = function () { setLang(r.value) }, c.appendChild(r), h.appendChild(c), l = document.createElement("div"), l.className = "control-row", g = document.createElement("div"), g.setAttribute("data-i18n", "control.theme"), g.textContent = t("control.theme"), l.appendChild(g), n = document.createElement("select"), n.id = "theme_select", a = document.createElement("option"), a.value = "auto", a.setAttribute("data-i18n", "theme.auto"), a.textContent = t("theme.auto"), v = document.createElement("option"), v.value = "light", v.setAttribute("data-i18n", "theme.light"), v.textContent = t("theme.light"), y = document.createElement("option"), y.value = "dark", y.setAttribute("data-i18n", "theme.dark"), y.textContent = t("theme.dark"), n.appendChild(a), n.appendChild(v), n.appendChild(y), n.value = APP_STATE.theme, n.onchange = function () { setTheme(n.value) }, l.appendChild(n), h.appendChild(l), i.appendChild(h), p = document.createElement("div"), p.className = "nav", e = document.createElement("div"), e.className = "nav-section", w = document.createElement("div"), w.className = "nav-section-title", w.setAttribute("data-i18n", "nav.basic"), w.textContent = t("nav.basic"), e.appendChild(w), e.appendChild(o("/", "nav.firmware", "firmware")), e.appendChild(o("/uboot.html", "nav.uboot", "uboot")), p.appendChild(e), u = document.createElement("div"), u.className = "nav-section", b = document.createElement("div"), b.className = "nav-section-title", b.setAttribute("data-i18n", "nav.advanced"), b.textContent = t("nav.advanced"), u.appendChild(b), u.appendChild(o("/bl2.html", "nav.bl2", "bl2")), u.appendChild(o("/gpt.html", "nav.gpt", "gpt")), u.appendChild(o("/initramfs.html", "nav.initramfs", "initramfs")), p.appendChild(u), i.appendChild(p), applyI18n(i)) } function ajax(n) { var t, i; t = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"); t.upload.addEventListener("progress", function (t) { n.progress && n.progress(t) }); t.onreadystatechange = function () { t.readyState == 4 && t.status == 200 && n.done && n.done(t.responseText) }; n.timeout && (t.timeout = n.timeout); i = "GET"; n.data && (i = "POST"); t.open(i, n.url); t.send(n.data) } function appInit(n) { APP_STATE.page = n || ""; APP_STATE.lang = detectLang(); APP_STATE.theme = detectTheme(); setTheme(APP_STATE.theme); setLang(APP_STATE.lang); ensureSidebar(); ensureBranding(); applyI18n(document); updateDocumentTitle(); setTimeout(function () { document.body.classList.add("ready") }, 0); getversion(); (n === "index" || n === "initramfs") && getmtdlayoutlist() } function startup() { appInit("index") } function getmtdlayoutlist() { ajax({ url: "/getmtdlayout", done: function (n) { var i, f, e, u, r, o; if (n != "error" && (i = n.split(";"), f = document.getElementById("current_mtd_layout"), f && (f.innerHTML = t("label.current_mtd") + i[0]), e = document.getElementById("choose_mtd_layout"), e && (e.textContent = t("label.choose_mtd")), u = document.getElementById("mtd_layout_label"), u)) { for (u.options.length = 0, r = 1; r < i.length; r++)i[r].length > 0 && u.options.add(new Option(i[r], i[r])); o = document.getElementById("mtd_layout"); o && (o.style.display = "") } } }) } function getversion() { ajax({ url: "/version", done: function (n) { var t = document.getElementById("version"); t && (t.innerHTML = n); ensureBranding() } }) } function upload(n) { var o = document.getElementById("file").files[0], u, f, e, r, i, s; o && (u = document.getElementById("form"), u && (u.style.display = "none"), f = document.getElementById("hint"), f && (f.style.display = "none"), e = document.getElementById("bar"), e && (e.style.display = "block"), r = new FormData, r.append(n, o), i = document.getElementById("mtd_layout_label"), i && i.options.length > 0 && (s = i.selectedIndex, r.append("mtd_layout", i.options[s].value)), ajax({ url: "/upload", data: r, done: function (n) { var i, r, u, f, e; n == "fail" ? location = "/fail.html" : (i = n.split(" "), r = document.getElementById("size"), r && (r.style.display = "block", r.innerHTML = t("label.size") + i[0]), u = document.getElementById("md5"), u && (u.style.display = "block", u.innerHTML = t("label.md5") + i[1]), f = document.getElementById("mtd"), f && i[2] && (f.style.display = "block", f.innerHTML = t("label.mtd") + i[2]), e = document.getElementById("upgrade"), e && (e.style.display = "block")) }, progress: function (n) { if (n.total) { var i = parseInt(n.loaded / n.total * 100), t = document.getElementById("bar"); t && (t.style.display = "block", t.style.setProperty("--percent", i)) } } })) } var I18N = { en: { "app.name": "Recovery Mode WEBUI", "nav.basic": "Basic", "nav.advanced": "Advanced", "nav.firmware": "Firmware update", "nav.uboot": "U-Boot update", "nav.bl2": "BL2 update", "nav.gpt": "GPT update", "nav.initramfs": "Load initramfs", "control.language": "ğŸŒLanguage", "control.theme": "ğŸŒ“Theme", "theme.auto": "Auto", "theme.light": "Light", "theme.dark": "Dark", "common.upload": "Upload", "common.update": "Update", "common.boot": "Boot", "common.warnings": "WARNINGS", "label.size": "Size: ", "label.md5": "MD5: ", "label.mtd": "MTD layout: ", "label.current_mtd": "Current mtd layout: ", "label.choose_mtd": "Choose mtd layout:", "index.title": "FIRMWARE UPDATE", "index.hint": "You are going to update <strong>firmware<\/strong> on the device.<br>Please, choose file from your local hard drive and click <strong>Upload<\/strong> button.", "index.upgrade_hint": 'If all information above is correct, click "Update".', "index.warn.1": "do not power off the device during update", "index.warn.2": "if everything goes well, the device will restart", "index.warn.3": "you can upload whatever you want, so be sure that you choose proper firmware image for your device", "uboot.title": "U-BOOT UPDATE", "uboot.hint": "You are going to update <strong>U-Boot (bootloader)<\/strong> on the device.<br>Please, choose file from your local hard drive and click <strong>Upload<\/strong> button.", "uboot.upgrade_hint": 'If all information above is correct, click "Update".', "uboot.warn.1": "do not power off the device during update", "uboot.warn.2": "if everything goes well, the device will restart", "uboot.warn.3": "you can upload whatever you want, so be sure that you choose proper U-Boot image for your device", "uboot.warn.4": "updating U-Boot is a very dangerous operation and may damage your device!", "bl2.title": "BL2 UPDATE", "bl2.hint": "You are going to update <strong>BL2 (preloader)<\/strong> on the device.<br>Please, choose file from your local hard drive and click <strong>Upload<\/strong> button.", "bl2.upgrade_hint": 'If all information above is correct, click "Update".', "bl2.warn.1": "do not power off the device during update", "bl2.warn.2": "if everything goes well, the device will restart", "bl2.warn.3": "you can upload whatever you want, so be sure that you choose proper BL2 image for your device", "bl2.warn.4": "updating BL2 is a very dangerous operation and may damage your device!", "gpt.title": "GPT UPDATE", "gpt.hint": "You are going to update <strong>GPT (Partition Table)<\/strong> on the device.<br>Please, choose file from your local hard drive and click <strong>Upload<\/strong> button.", "gpt.upgrade_hint": 'If all information above is correct, click "Update".', "gpt.warn.1": "do not power off the device during update", "gpt.warn.2": "if everything goes well, the device will restart", "gpt.warn.3": "you can upload whatever you want, so be sure that you choose proper GPT for your device", "gpt.warn.4": "updating GPT is a dangerous operation and may damage your device!", "initramfs.title": "LOAD INITRAMFS", "initramfs.hint": "You are going to load <strong>initramfs<\/strong> on the device.<br>Please, choose file from your local hard drive and click <strong>Upload<\/strong> button.", "initramfs.boot_hint": 'If all information above is correct, click "Boot".', "initramfs.warn.1": "if everything goes well, the device will boot into the initramfs", "initramfs.warn.2": "you can upload whatever you want, so be sure that you choose proper initramfs image for your device", "flashing.title.in_progress": "UPDATE IN PROGRESS", "flashing.info.in_progress": "Your file was successfully uploaded! Update is in progress and you should wait for automatic reset of the device.<br>Update time depends on image size and may take up to a few minutes.", "flashing.title.done": "UPDATE COMPLETED", "flashing.info.done": "Your device was successfully updated! Now rebooting...", "booting.title.in_progress": "BOOTING INITRAMFS", "booting.info.in_progress": "Your file was successfully uploaded! Booting is in progress, please wait...<br>This page may be in not responding status for a short time.", "booting.title.done": "BOOT SUCCESS", "booting.info.done": "Your device was successfully booted into initramfs!", "fail.title": "UPDATE FAILED", "fail.msg.strong": "Something went wrong during update", "fail.msg.rest": "Probably you have chosen wrong file. Please, try again or contact with the author of this modification. You can also get more information during update in U-Boot console.", "404.title": "PAGE NOT FOUND", "404.msg": "The page you were looking for doesn't exist!" }, "zh-cn": { "app.name": "æ¢å¤æ¨¡å¼ WEBUI", "nav.basic": "åŸºç¡€åŠŸèƒ½", "nav.advanced": "é«˜çº§åŠŸèƒ½", "nav.firmware": "å›ºä»¶å‡çº§", "nav.uboot": "U-Boot åˆ·å†™", "nav.bl2": "BL2 æ›´æ–°", "nav.gpt": "GPT åˆ†åŒºè¡¨æ›´æ–°", "nav.initramfs": "å¯åŠ¨ Initramfs", "control.language": "ğŸŒè¯­è¨€", "control.theme": "ğŸŒ“ä¸»é¢˜", "theme.auto": "è‡ªåŠ¨", "theme.light": "äº®è‰²", "theme.dark": "æš—è‰²", "common.upload": "ä¸Šä¼ ", "common.update": "æ›´æ–°", "common.boot": "å¯åŠ¨", "common.warnings": "æ³¨æ„äº‹é¡¹", "label.size": "å¤§å°ï¼š", "label.md5": "MD5ï¼š", "label.mtd": "MTD å¸ƒå±€ï¼š", "label.current_mtd": "å½“å‰ mtd å¸ƒå±€ï¼š", "label.choose_mtd": "é€‰æ‹© mtd å¸ƒå±€ï¼š", "index.title": "å›ºä»¶å‡çº§", "index.hint": "ä½ å°†è¦åœ¨è®¾å¤‡ä¸Šæ›´æ–° <strong>å›ºä»¶<\/strong>ã€‚<br>è¯·é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¹¶ç‚¹å‡» <strong>ä¸Šä¼ <\/strong> æŒ‰é’®ã€‚", "index.upgrade_hint": "å¦‚æœä»¥ä¸Šä¿¡æ¯ç¡®è®¤æ— è¯¯ï¼Œè¯·ç‚¹å‡»â€œæ›´æ–°â€ã€‚", "index.warn.1": "å‡çº§è¿‡ç¨‹ä¸­è¯·å‹¿æ–­ç”µ", "index.warn.2": "å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œè®¾å¤‡ä¼šè‡ªåŠ¨é‡å¯", "index.warn.3": "ä½ å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œè¯·ç¡®ä¿é€‰æ‹©äº†ä¸ä½ çš„è®¾å¤‡åŒ¹é…çš„å›ºä»¶é•œåƒ", "uboot.title": "U-Boot åˆ·å†™", "uboot.hint": "ä½ å°†è¦åœ¨è®¾å¤‡ä¸Šæ›´æ–° <strong>U-Bootï¼ˆå¼•å¯¼ç¨‹åºï¼‰<\/strong>ã€‚<br>è¯·é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¹¶ç‚¹å‡» <strong>ä¸Šä¼ <\/strong> æŒ‰é’®ã€‚", "uboot.upgrade_hint": "å¦‚æœä»¥ä¸Šä¿¡æ¯ç¡®è®¤æ— è¯¯ï¼Œè¯·ç‚¹å‡»â€œæ›´æ–°â€ã€‚", "uboot.warn.1": "åˆ·å†™è¿‡ç¨‹ä¸­è¯·å‹¿æ–­ç”µ", "uboot.warn.2": "å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œè®¾å¤‡ä¼šè‡ªåŠ¨é‡å¯", "uboot.warn.3": "ä½ å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œè¯·ç¡®ä¿é€‰æ‹©äº†ä¸ä½ çš„è®¾å¤‡åŒ¹é…çš„ U-Boot é•œåƒ", "uboot.warn.4": "åˆ·å†™ U-Boot é£é™©æé«˜ï¼Œå¯èƒ½å¯¼è‡´è®¾å¤‡æŸåï¼", "bl2.title": "BL2 æ›´æ–°", "bl2.hint": "ä½ å°†è¦åœ¨è®¾å¤‡ä¸Šæ›´æ–° <strong>BL2ï¼ˆé¢„åŠ è½½å™¨ï¼‰<\/strong>ã€‚<br>è¯·é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¹¶ç‚¹å‡» <strong>ä¸Šä¼ <\/strong> æŒ‰é’®ã€‚", "bl2.upgrade_hint": "å¦‚æœä»¥ä¸Šä¿¡æ¯ç¡®è®¤æ— è¯¯ï¼Œè¯·ç‚¹å‡»â€œæ›´æ–°â€ã€‚", "bl2.warn.1": "åˆ·å†™è¿‡ç¨‹ä¸­è¯·å‹¿æ–­ç”µ", "bl2.warn.2": "å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œè®¾å¤‡ä¼šè‡ªåŠ¨é‡å¯", "bl2.warn.3": "ä½ å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œè¯·ç¡®ä¿é€‰æ‹©äº†ä¸ä½ çš„è®¾å¤‡åŒ¹é…çš„ BL2 é•œåƒ", "bl2.warn.4": "æ›´æ–° BL2 é£é™©æé«˜ï¼Œå¯èƒ½å¯¼è‡´è®¾å¤‡æŸåï¼", "gpt.title": "GPT åˆ†åŒºè¡¨æ›´æ–°", "gpt.hint": "ä½ å°†è¦åœ¨è®¾å¤‡ä¸Šæ›´æ–° <strong>GPTï¼ˆåˆ†åŒºè¡¨ï¼‰<\/strong>ã€‚<br>è¯·é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¹¶ç‚¹å‡» <strong>ä¸Šä¼ <\/strong> æŒ‰é’®ã€‚", "gpt.upgrade_hint": "å¦‚æœä»¥ä¸Šä¿¡æ¯ç¡®è®¤æ— è¯¯ï¼Œè¯·ç‚¹å‡»â€œæ›´æ–°â€ã€‚", "gpt.warn.1": "åˆ·å†™è¿‡ç¨‹ä¸­è¯·å‹¿æ–­ç”µ", "gpt.warn.2": "å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œè®¾å¤‡ä¼šè‡ªåŠ¨é‡å¯", "gpt.warn.3": "ä½ å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œè¯·ç¡®ä¿é€‰æ‹©äº†ä¸ä½ çš„è®¾å¤‡åŒ¹é…çš„ GPT", "gpt.warn.4": "æ›´æ–° GPT æœ‰é£é™©ï¼Œå¯èƒ½å¯¼è‡´è®¾å¤‡æŸåï¼", "initramfs.title": "å¯åŠ¨ Initramfs", "initramfs.hint": "ä½ å°†è¦åœ¨è®¾å¤‡ä¸ŠåŠ è½½ <strong>initramfs<\/strong>ã€‚<br>è¯·é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¹¶ç‚¹å‡» <strong>ä¸Šä¼ <\/strong> æŒ‰é’®ã€‚", "initramfs.boot_hint": "å¦‚æœä»¥ä¸Šä¿¡æ¯ç¡®è®¤æ— è¯¯ï¼Œè¯·ç‚¹å‡»â€œå¯åŠ¨â€ã€‚", "initramfs.warn.1": "å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œè®¾å¤‡å°†è¿›å…¥ initramfs", "initramfs.warn.2": "ä½ å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œè¯·ç¡®ä¿é€‰æ‹©äº†ä¸ä½ çš„è®¾å¤‡åŒ¹é…çš„ initramfs é•œåƒ", "flashing.title.in_progress": "æ­£åœ¨åˆ·å†™â€¦", "flashing.info.in_progress": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼æ­£åœ¨æ‰§è¡Œåˆ·å†™ï¼Œè¯·ç­‰å¾…è®¾å¤‡è‡ªåŠ¨é‡å¯ã€‚<br>åˆ·å†™æ—¶é—´å–å†³äºé•œåƒå¤§å°ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿã€‚", "flashing.title.done": "åˆ·å†™å®Œæˆ", "flashing.info.done": "è®¾å¤‡å·²æˆåŠŸæ›´æ–°ï¼å³å°†é‡å¯â€¦", "booting.title.in_progress": "æ­£åœ¨å¯åŠ¨ Initramfsâ€¦", "booting.info.in_progress": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼æ­£åœ¨å¯åŠ¨ï¼Œè¯·ç¨å€™â€¦<br>è¯¥é¡µé¢çŸ­æ—¶é—´å¯èƒ½æ˜¾ç¤ºæ— å“åº”ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ã€‚", "booting.title.done": "å¯åŠ¨æˆåŠŸ", "booting.info.done": "è®¾å¤‡å·²æˆåŠŸè¿›å…¥ initramfsï¼", "fail.title": "æ›´æ–°å¤±è´¥", "fail.msg.strong": "æ›´æ–°è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯", "fail.msg.rest": "å¯èƒ½é€‰æ‹©äº†é”™è¯¯çš„æ–‡ä»¶ã€‚è¯·é‡è¯•æˆ–è”ç³»æ­¤ä¿®æ”¹çš„ä½œè€…ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨ U-Boot æ§åˆ¶å°æŸ¥çœ‹æ›´å¤šåˆ·å†™è¿‡ç¨‹ä¿¡æ¯ã€‚", "404.title": "é¡µé¢ä¸å­˜åœ¨", "404.msg": "ä½ è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨ï¼" } }, APP_STATE = { lang: "en", theme: "auto", page: "" }